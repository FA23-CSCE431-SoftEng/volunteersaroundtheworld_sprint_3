<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="<%= asset_path('admin_dash.css') %>">
    <title>Admin Dashboard</title>
</head>
<body>
<header>
    <div class="header-content">
        <img src="<%= asset_path('IMG_6562.png') %>" alt="logo" class="logo-icon">
        <h1>Admin Dashboard</h1>
        <%= link_to "Log Out", logout_path, class: "logout-button" %>
        </header>

<div class="horizontal-container">
    <!-- Form to grant admin status by email -->
    <div class="section">
        <%= form_with(url: add_admin_users_path, method: :post, local: true) do |f| %>
          <%= f.label :email, "Enter Email:" %>
          <%= f.text_field :email %>
          <%= f.submit "Grant Admin Status" %>
          <i class="fa-solid fa-shield"></i>
        <% end %>

        <!-- Current Admins Section -->
        <h2>Current Admins</h2>
        <table>
            <tbody>
            <% if @users.any? { |user| user.isAdmin? } %>
                <% @users.each do |user| %>
                    <% if user.isAdmin? %>
                        <tr>
                            <td><%= user.email %></td>
                        </tr>
                    <% end %>
                <% end %>
            <% else %>
                <tr>
                    <td>There aren't any current admins.</td>
                </tr>
            <% end %>
            </tbody>
        </table>
    </div>

    <!-- Manually Check-In a User Section -->
    <div class="section checkin-section">
        <h3>
            <a href="<%= admin_checkin_path %>" class="check-in-button">
                <i class="fas fa-user-plus"></i> Manually Check-In User
            </a>
        </h3>
    </div>

    <!-- Upcoming Events Section -->
    <div class="section events-section">
        <h2>Upcoming Events</h2>
        <div class="event-buttons">
            <%= link_to "Add Event", events_new_path, class: "add-event-button" %>
            <%= link_to "Add Final Countdown Event", new_final_countdown_event_path, class: "add-event-button" %>
        </div>
        <div class="event-list">
            <% upcoming_events = @events.select { |event| event.date.present? && event.date >= Date.today } %>
            <% if upcoming_events.any? %>
                <% upcoming_events.each do |event| %>
                    <div class="event-item <%= 'final-countdown-event' if event.hasCountdown %>">
                    <div class="event-details">
                        <span><%= event.name %> <%= event.date.present? ? "- #{event.date.strftime('%B %d, %Y')}" : "- Date not set" %></span>
                        </div>
                        <%= form_with url: event_path(event), method: :delete, class: 'delete-form' do %>
                            <%= button_tag type: 'submit', class: 'delete-button', data: { confirm: "Are you sure you want to delete the #{event.name} event?" } do %>
                                <i class="fa-solid fa-trash-can"></i>
                            <% end %>
                        <% end %>
                        <div class="dropdown">
                            <button>
                                <i class="fas fa-users"></i>
                            </button>
                            <div class="dropdown-content">
                            <% if event.users.any? %>
                                <a class="static-item" href="#">Attendance</a>
                                <% event.users.each do |user| %>
                                    <a href="#"><%= user.first_name + " " + user.last_name %></a>
                                <% end %>
                            <% else %>
                                <a class="static-item" href="#">Attendance</a>
                                <a class="static-item-no-attendance" href="#">No users have checked in to this event.</a>
                            <% end %>
                            </div>
                        </div>
                    </div>
                <% end %>
                <!-- "View All Events" button stays where it is -->
                <div class="event-item">
                    <%= link_to "View All Events", events_path, class: "view-all-events-button" %>
                </div>
            <% else %>
                <p>No upcoming events.</p>
                <div class="event-item">
                    <%= link_to "View All Events", events_path, class: "view-all-events-button" %>
                </div>
            <% end %>
        </div>
    </div>    
</div>
</header>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Get all delete buttons with a data-confirm attribute
        const deleteButtons = document.querySelectorAll('.delete-button[data-confirm]');

        // Function to handle the click event on delete buttons
        function handleDeleteButtonClick(event) {
            const confirmationMessage = event.currentTarget.getAttribute('data-confirm');
            const isConfirmed = confirm(confirmationMessage);

            if (!isConfirmed) {
                event.preventDefault(); // Prevent the default action (deleting the event)
            }
        }

        // Add a click event listener to each delete button
        deleteButtons.forEach((button) => {
            button.addEventListener('click', handleDeleteButtonClick);
        });
    });
</script>
</body>
</html>
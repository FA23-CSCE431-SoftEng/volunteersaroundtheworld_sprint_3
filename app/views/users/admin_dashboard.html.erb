<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
</head>
<body>
<style>

    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f1efee;
        overflow: auto; /* Allow body to scroll */
    }

    .delete-form {
        display: inline-block;
        margin: 0;
        padding: 0;
    }

    header {
        background-color: #500000;
        color: white;
        text-align: center;
        padding: 20px 0;
        position: relative;
    }

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    h1 {
        font-weight: bold;
        display: inline-block;
        width: 100%;
    }

    .logout-button {
        background-color: #f44336;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        position: absolute;
        top: 50%;
        right: 20px;
        transform: translateY(-50%);
        z-index: 1;
    }

    .logout-button:hover {
        background-color: #d32f2f;
    }

    /* Add styles for the logo icon */
    .logo-icon {
        width: 40px; /* Adjust the width and height to fit your logo's size */
        height: 40px;
        border-radius: 50%; /* Make it circular */
        margin-right: 10px; /* Add some spacing between the logo and "Admin Dashboard" */
        position: absolute;
        top: 50%;
        left: 20px;
        transform: translateY(-50%);
        z-index: 1;
    }

    .section {
        background-color: #fff;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        margin: 10px;
        flex: 1;
    }

    .horizontal-container {
        display: flex;
        justify-content: space-between;
        width: 100%;
    }

    .checkin-section {
        width: 200px;
        height: 100px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .check-in-button {
        display: inline-block;
        background-color: #4CAF50; /* Green background color */
        color: white; /* White text color */
        padding: 10px 15px; /* Add padding to the button */
        border: none;
        border-radius: 5px;
        cursor: pointer;
        text-decoration: none; /* Remove default underline from links */
    }

    .check-in-button:hover {
        background-color: #45a049; /* Darker green color on hover */
    }

    .events-section {
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .event-list {
        margin-top: 10px;
        overflow: hidden;
    }

    .event-item {
        margin-bottom: 10px;
        display: flex;
        align-items: center; /* Center items vertically */
    }

    .event-details {
        flex-grow: 1; /* Allow event details to grow and take up available space */
        white-space: nowrap; /* Prevent wrapping */
        padding-right: 10px; /* Add right padding to create space */
    }

    .add-event-button {
        margin: 3px;
    }

    .delete-button {
        padding: 5px 10px; /* Add space to the left and right sides */
        background-color: #ff0000;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 10px;
    }

    .delete-button:hover {
        background-color: #bc0b0b;
    }

    button, input[type="submit"] {
    background-color: #4CAF50;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
    }

    button:hover, input[type="submit"]:hover {
    background-color: #45a049;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 250px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
        right: 0; /* Position the dropdown to the right */
    }
    
    /* Left-aligned dropdown */
    .dropdown.left .dropdown-content {
        right: auto;
        left: 0;
    }

    .dropdown-content .static-item {
        font-weight: bold;
        color: black;
    }

    .dropdown-content .static-item-no-attendance {
        color: black;
    }

    .dropdown-content a {
        color: black;
        padding: 5px 10px 2px 5px;
        text-decoration: none;
        display: block;
    }

    .dropdown-content a:hover {
        background-color: transparent; /* Remove hover background color */
    }

    .dropdown:hover .dropdown-content {
        display: block;
    }

</style>

<header>
    <div class="header-content">
        <img src="path_to_your_logo_image.png" alt="Organization Logo" class="logo-icon">
        <h1>Admin Dashboard</h1>
        <%= link_to "Log Out", logout_path, class: "logout-button" %>
        </header>

<div class="horizontal-container">
    <!-- Form to grant admin status by email -->
    <div class="section">
        <%= form_with(url: add_admin_users_path, method: :post, local: true) do |f| %>
          <%= f.label :email, "Enter Email:" %>
          <%= f.text_field :email %>
          <%= f.submit "Grant Admin Status" %>
          <i class="fa-solid fa-shield"></i>
        <% end %>

        <!-- Current Admins Section -->
        <h2>Current Admins</h2>
        <table>
            <tbody>
            <% if @users.any? { |user| user.isAdmin? } %>
                <% @users.each do |user| %>
                    <% if user.isAdmin? %>
                        <tr>
                            <td><%= user.email %></td>
                        </tr>
                    <% end %>
                <% end %>
            <% else %>
                <tr>
                    <td>There aren't any current admins.</td>
                </tr>
            <% end %>
            </tbody>
        </table>
    </div>

    <!-- Manually Check-In a User Section -->
    <div class="section checkin-section">
        <h3>
            <a href="<%= admin_checkin_path %>" class="check-in-button">
                <i class="fas fa-user-plus"></i> Manually Check-In User
            </a>
        </h3>
    </div>

    <!-- Upcoming Events Section -->
    <div class="section events-section">
        <h2>Upcoming Events</h2>
        <div class="event-buttons">
            <%= link_to "Add Event", events_new_path, class: "add-event-button" %>
            <%= link_to "Add Final Countdown Event", new_final_countdown_event_path, class: "add-final-countdown-button" %>
        </div>
        <div class="event-list">
            <% upcoming_events = @events.select { |event| event.date.present? && event.date >= Date.today } %>
            <% if upcoming_events.any? %>
                <% upcoming_events.each do |event| %>
                    <div class="event-item <%= 'final-countdown-event' if event.hasCountdown %>">
                    <div class="event-details">
                        <span><%= event.name %> <%= event.date.present? ? "- #{event.date.strftime('%B %d, %Y')}" : "- Date not set" %></span>
                        </div>
                        <%= form_with url: event_path(event), method: :delete, class: 'delete-form' do %>
                            <%= button_tag type: 'submit', class: 'delete-button', data: { confirm: "Are you sure you want to delete the #{event.name} event?" } do %>
                                <i class="fa-solid fa-trash-can"></i>
                            <% end %>
                        <% end %>
                        <div class="dropdown">
                            <button>
                                <i class="fas fa-users"></i>
                            </button>
                            <div class="dropdown-content">
                            <% if event.users.any? %>
                                <a class="static-item" href="#">Attendance</a>
                                <% event.users.each do |user| %>
                                    <a href="#"><%= user.first_name + " " + user.last_name %></a>
                                <% end %>
                            <% else %>
                                <a class="static-item" href="#">Attendance</a>
                                <a class="static-item-no-attendance" href="#">No users have checked in to this event.</a>
                            <% end %>
                            </div>
                        </div>
                    </div>
                <% end %>
                <!-- "View All Events" button stays where it is -->
                <div class="event-item">
                    <%= link_to "View All Events", events_path, class: "view-all-events-button" %>
                </div>
            <% else %>
                <p>No upcoming events.</p>
                <div class="event-item">
                    <%= link_to "View All Events", events_path, class: "view-all-events-button" %>
                </div>
            <% end %>
        </div>
    </div>    
</div>
</header>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Get all delete buttons with a data-confirm attribute
        const deleteButtons = document.querySelectorAll('.delete-button[data-confirm]');

        // Function to handle the click event on delete buttons
        function handleDeleteButtonClick(event) {
            const confirmationMessage = event.currentTarget.getAttribute('data-confirm');
            const isConfirmed = confirm(confirmationMessage);

            if (!isConfirmed) {
                event.preventDefault(); // Prevent the default action (deleting the event)
            }
        }

        // Add a click event listener to each delete button
        deleteButtons.forEach((button) => {
            button.addEventListener('click', handleDeleteButtonClick);
        });
    });
</script>
</body>
</html>